# file_event_win_powershell_exploit_scripts

## Title
Malicious PowerShell Scripts - FileCreation

## ID
f331aa1f-8c53-4fc3-b083-cc159bc971cb

## Author
Markus Neis, Nasreddine Bencherchali (Nextron Systems), Mustafa Kaan Demir, Georg Lauenstein

## Date
2018-04-07

## Tags
attack.execution, attack.t1059.001

## Description
Detects the creation of known offensive powershell scripts used for exploitation

## References
https://github.com/PowerShellMafia/PowerSploit
https://github.com/NetSPI/PowerUpSQL
https://github.com/CsEnox/EventViewer-UACBypass
https://web.archive.org/web/20210511204621/https://github.com/AlsidOfficial/WSUSpendu
https://github.com/nettitude/Invoke-PowerThIEf
https://github.com/S3cur3Th1sSh1t/WinPwn
https://github.com/S3cur3Th1sSh1t/PowerSharpPack/tree/master/PowerSharpBinaries
https://github.com/BC-SECURITY/Invoke-ZeroLogon/blob/111d17c7fec486d9bb23387e2e828b09a26075e4/Invoke-ZeroLogon.ps1
https://github.com/xorrior/RandomPS-Scripts/blob/848c919bfce4e2d67b626cbcf4404341cfe3d3b6/Get-DXWebcamVideo.ps1
https://github.com/rvrsh3ll/Misc-Powershell-Scripts/blob/6f23bb41f9675d7e2d32bacccff75e931ae00554/OfficeMemScraper.ps1
https://github.com/dafthack/DomainPasswordSpray/blob/b13d64a5834694aa73fd2aea9911a83027c465a7/DomainPasswordSpray.ps1
https://unit42.paloaltonetworks.com/threat-assessment-black-basta-ransomware/
https://research.nccgroup.com/2022/06/06/shining-the-light-on-black-basta/
https://github.com/HarmJ0y/DAMP
https://github.com/samratashok/nishang
https://github.com/DarkCoderSc/PowerRunAsSystem/
https://github.com/besimorhino/powercat
https://github.com/Kevin-Robertson/Powermad
https://github.com/adrecon/ADRecon
https://github.com/adrecon/AzureADRecon

## False Positives
Unknown

## SentinelOne Query
```
ObjectType = "File" AND (EndpointOS = "windows" AND ((TgtFilePath endswithCIS "\Add-ConstrainedDelegationBackdoor.ps1" OR TgtFilePath endswithCIS "\Add-Exfiltration.ps1" OR TgtFilePath endswithCIS "\Add-Persistence.ps1" OR TgtFilePath endswithCIS "\Add-RegBackdoor.ps1" OR TgtFilePath endswithCIS "\Add-RemoteRegBackdoor.ps1" OR TgtFilePath endswithCIS "\Add-ScrnSaveBackdoor.ps1" OR TgtFilePath endswithCIS "\ADRecon.ps1" OR TgtFilePath endswithCIS "\AzureADRecon.ps1" OR TgtFilePath endswithCIS "\Check-VM.ps1" OR TgtFilePath endswithCIS "\ConvertTo-ROT13.ps1" OR TgtFilePath endswithCIS "\Copy-VSS.ps1" OR TgtFilePath endswithCIS "\Create-MultipleSessions.ps1" OR TgtFilePath endswithCIS "\DNS_TXT_Pwnage.ps1" OR TgtFilePath endswithCIS "\dnscat2.ps1" OR TgtFilePath endswithCIS "\Do-Exfiltration.ps1" OR TgtFilePath endswithCIS "\DomainPasswordSpray.ps1" OR TgtFilePath endswithCIS "\Download_Execute.ps1" OR TgtFilePath endswithCIS "\Download-Execute-PS.ps1" OR TgtFilePath endswithCIS "\Enable-DuplicateToken.ps1" OR TgtFilePath endswithCIS "\Enabled-DuplicateToken.ps1" OR TgtFilePath endswithCIS "\Execute-Command-MSSQL.ps1" OR TgtFilePath endswithCIS "\Execute-DNSTXT-Code.ps1" OR TgtFilePath endswithCIS "\Execute-OnTime.ps1" OR TgtFilePath endswithCIS "\ExetoText.ps1" OR TgtFilePath endswithCIS "\Exploit-Jboss.ps1" OR TgtFilePath endswithCIS "\Find-AVSignature.ps1" OR TgtFilePath endswithCIS "\Find-Fruit.ps1" OR TgtFilePath endswithCIS "\Find-GPOLocation.ps1" OR TgtFilePath endswithCIS "\Find-TrustedDocuments.ps1" OR TgtFilePath endswithCIS "\FireBuster.ps1" OR TgtFilePath endswithCIS "\FireListener.ps1" OR TgtFilePath endswithCIS "\Get-ApplicationHost.ps1" OR TgtFilePath endswithCIS "\Get-ChromeDump.ps1" OR TgtFilePath endswithCIS "\Get-ClipboardContents.ps1" OR TgtFilePath endswithCIS "\Get-ComputerDetail.ps1" OR TgtFilePath endswithCIS "\Get-FoxDump.ps1" OR TgtFilePath endswithCIS "\Get-GPPAutologon.ps1" OR TgtFilePath endswithCIS "\Get-GPPPassword.ps1" OR TgtFilePath endswithCIS "\Get-IndexedItem.ps1" OR TgtFilePath endswithCIS "\Get-Keystrokes.ps1" OR TgtFilePath endswithCIS "\Get-LSASecret.ps1" OR TgtFilePath endswithCIS "\Get-MicrophoneAudio.ps1" OR TgtFilePath endswithCIS "\Get-PassHashes.ps1" OR TgtFilePath endswithCIS "\Get-PassHints.ps1" OR TgtFilePath endswithCIS "\Get-RegAlwaysInstallElevated.ps1" OR TgtFilePath endswithCIS "\Get-RegAutoLogon.ps1" OR TgtFilePath endswithCIS "\Get-RickAstley.ps1" OR TgtFilePath endswithCIS "\Get-Screenshot.ps1" OR TgtFilePath endswithCIS "\Get-SecurityPackages.ps1" OR TgtFilePath endswithCIS "\Get-ServiceFilePermission.ps1" OR TgtFilePath endswithCIS "\Get-ServicePermission.ps1" OR TgtFilePath endswithCIS "\Get-ServiceUnquoted.ps1" OR TgtFilePath endswithCIS "\Get-SiteListPassword.ps1" OR TgtFilePath endswithCIS "\Get-System.ps1" OR TgtFilePath endswithCIS "\Get-TimedScreenshot.ps1" OR TgtFilePath endswithCIS "\Get-UnattendedInstallFile.ps1" OR TgtFilePath endswithCIS "\Get-Unconstrained.ps1" OR TgtFilePath endswithCIS "\Get-USBKeystrokes.ps1" OR TgtFilePath endswithCIS "\Get-VaultCredential.ps1" OR TgtFilePath endswithCIS "\Get-VulnAutoRun.ps1" OR TgtFilePath endswithCIS "\Get-VulnSchTask.ps1" OR TgtFilePath endswithCIS "\Get-WebConfig.ps1" OR TgtFilePath endswithCIS "\Get-WebCredentials.ps1" OR TgtFilePath endswithCIS "\Get-WLAN-Keys.ps1" OR TgtFilePath endswithCIS "\Gupt-Backdoor.ps1" OR TgtFilePath endswithCIS "\HTTP-Backdoor.ps1" OR TgtFilePath endswithCIS "\HTTP-Login.ps1" OR TgtFilePath endswithCIS "\Install-ServiceBinary.ps1" OR TgtFilePath endswithCIS "\Install-SSP.ps1" OR TgtFilePath endswithCIS "\Invoke-ACLScanner.ps1" OR TgtFilePath endswithCIS "\Invoke-ADSBackdoor.ps1" OR TgtFilePath endswithCIS "\Invoke-AmsiBypass.ps1" OR TgtFilePath endswithCIS "\Invoke-ARPScan.ps1" OR TgtFilePath endswithCIS "\Invoke-BackdoorLNK.ps1" OR TgtFilePath endswithCIS "\Invoke-BadPotato.ps1" OR TgtFilePath endswithCIS "\Invoke-BetterSafetyKatz.ps1" OR TgtFilePath endswithCIS "\Invoke-BruteForce.ps1" OR TgtFilePath endswithCIS "\Invoke-BypassUAC.ps1" OR TgtFilePath endswithCIS "\Invoke-Carbuncle.ps1" OR TgtFilePath endswithCIS "\Invoke-Certify.ps1" OR TgtFilePath endswithCIS "\Invoke-ConPtyShell.ps1" OR TgtFilePath endswithCIS "\Invoke-CredentialInjection.ps1" OR TgtFilePath endswithCIS "\Invoke-CredentialsPhish.ps1" OR TgtFilePath endswithCIS "\Invoke-DAFT.ps1" OR TgtFilePath endswithCIS "\Invoke-DCSync.ps1" OR TgtFilePath endswithCIS "\Invoke-Decode.ps1" OR TgtFilePath endswithCIS "\Invoke-DinvokeKatz.ps1" OR TgtFilePath endswithCIS "\Invoke-DllInjection.ps1" OR TgtFilePath endswithCIS "\Invoke-DNSUpdate.ps1" OR TgtFilePath endswithCIS "\Invoke-DowngradeAccount.ps1" OR TgtFilePath endswithCIS "\Invoke-EgressCheck.ps1" OR TgtFilePath endswithCIS "\Invoke-Encode.ps1" OR TgtFilePath endswithCIS "\Invoke-EventViewer.ps1" OR TgtFilePath endswithCIS "\Invoke-Eyewitness.ps1" OR TgtFilePath endswithCIS "\Invoke-FakeLogonScreen.ps1" OR TgtFilePath endswithCIS "\Invoke-Farmer.ps1" OR TgtFilePath endswithCIS "\Invoke-Get-RBCD-Threaded.ps1" OR TgtFilePath endswithCIS "\Invoke-Gopher.ps1" OR TgtFilePath endswithCIS "\Invoke-Grouper2.ps1" OR TgtFilePath endswithCIS "\Invoke-Grouper3.ps1" OR TgtFilePath endswithCIS "\Invoke-HandleKatz.ps1" OR TgtFilePath endswithCIS "\Invoke-Interceptor.ps1" OR TgtFilePath endswithCIS "\Invoke-Internalmonologue.ps1" OR TgtFilePath endswithCIS "\Invoke-Inveigh.ps1" OR TgtFilePath endswithCIS "\Invoke-InveighRelay.ps1" OR TgtFilePath endswithCIS "\Invoke-JSRatRegsvr.ps1" OR TgtFilePath endswithCIS "\Invoke-JSRatRundll.ps1" OR TgtFilePath endswithCIS "\Invoke-KrbRelay.ps1" OR TgtFilePath endswithCIS "\Invoke-KrbRelayUp.ps1" OR TgtFilePath endswithCIS "\Invoke-LdapSignCheck.ps1" OR TgtFilePath endswithCIS "\Invoke-Lockless.ps1" OR TgtFilePath endswithCIS "\Invoke-MalSCCM.ps1" OR TgtFilePath endswithCIS "\Invoke-Mimikatz.ps1" OR TgtFilePath endswithCIS "\Invoke-MimikatzWDigestDowngrade.ps1" OR TgtFilePath endswithCIS "\Invoke-Mimikittenz.ps1" OR TgtFilePath endswithCIS "\Invoke-MITM6.ps1" OR TgtFilePath endswithCIS "\Invoke-NanoDump.ps1" OR TgtFilePath endswithCIS "\Invoke-NetRipper.ps1" OR TgtFilePath endswithCIS "\Invoke-NetworkRelay.ps1" OR TgtFilePath endswithCIS "\Invoke-NinjaCopy.ps1" OR TgtFilePath endswithCIS "\Invoke-OxidResolver.ps1" OR TgtFilePath endswithCIS "\Invoke-P0wnedshell.ps1" OR TgtFilePath endswithCIS "\Invoke-P0wnedshellx86.ps1" OR TgtFilePath endswithCIS "\Invoke-Paranoia.ps1" OR TgtFilePath endswithCIS "\Invoke-PortScan.ps1" OR TgtFilePath endswithCIS "\Invoke-PoshRatHttp.ps1" OR TgtFilePath endswithCIS "\Invoke-PoshRatHttps.ps1" OR TgtFilePath endswithCIS "\Invoke-PostExfil.ps1" OR TgtFilePath endswithCIS "\Invoke-PowerDump.ps1" OR TgtFilePath endswithCIS "\Invoke-PowerShellIcmp.ps1" OR TgtFilePath endswithCIS "\Invoke-PowerShellTCP.ps1" OR TgtFilePath endswithCIS "\Invoke-PowerShellTcpOneLine.ps1" OR TgtFilePath endswithCIS "\Invoke-PowerShellTcpOneLineBind.ps1" OR TgtFilePath endswithCIS "\Invoke-PowerShellUdp.ps1" OR TgtFilePath endswithCIS "\Invoke-PowerShellUdpOneLine.ps1" OR TgtFilePath endswithCIS "\Invoke-PowerShellWMI.ps1" OR TgtFilePath endswithCIS "\Invoke-PowerThIEf.ps1" OR TgtFilePath endswithCIS "\Invoke-PPLDump.ps1" OR TgtFilePath endswithCIS "\Invoke-Prasadhak.ps1" OR TgtFilePath endswithCIS "\Invoke-PsExec.ps1" OR TgtFilePath endswithCIS "\Invoke-PsGcat.ps1" OR TgtFilePath endswithCIS "\Invoke-PsGcatAgent.ps1" OR TgtFilePath endswithCIS "\Invoke-PSInject.ps1" OR TgtFilePath endswithCIS "\Invoke-PsUaCme.ps1" OR TgtFilePath endswithCIS "\Invoke-ReflectivePEInjection.ps1" OR TgtFilePath endswithCIS "\Invoke-ReverseDNSLookup.ps1" OR TgtFilePath endswithCIS "\Invoke-Rubeus.ps1" OR TgtFilePath endswithCIS "\Invoke-RunAs.ps1" OR TgtFilePath endswithCIS "\Invoke-SafetyKatz.ps1" OR TgtFilePath endswithCIS "\Invoke-SauronEye.ps1" OR TgtFilePath endswithCIS "\Invoke-SCShell.ps1" OR TgtFilePath endswithCIS "\Invoke-Seatbelt.ps1" OR TgtFilePath endswithCIS "\Invoke-ServiceAbuse.ps1" OR TgtFilePath endswithCIS "\Invoke-SessionGopher.ps1" OR TgtFilePath endswithCIS "\Invoke-ShellCode.ps1" OR TgtFilePath endswithCIS "\Invoke-SMBScanner.ps1" OR TgtFilePath endswithCIS "\Invoke-Snaffler.ps1" OR TgtFilePath endswithCIS "\Invoke-Spoolsample.ps1" OR TgtFilePath endswithCIS "\Invoke-SSHCommand.ps1" OR TgtFilePath endswithCIS "\Invoke-SSIDExfil.ps1" OR TgtFilePath endswithCIS "\Invoke-StandIn.ps1" OR TgtFilePath endswithCIS "\Invoke-StickyNotesExtract.ps1" OR TgtFilePath endswithCIS "\Invoke-Tater.ps1" OR TgtFilePath endswithCIS "\Invoke-Thunderfox.ps1" OR TgtFilePath endswithCIS "\Invoke-ThunderStruck.ps1" OR TgtFilePath endswithCIS "\Invoke-TokenManipulation.ps1" OR TgtFilePath endswithCIS "\Invoke-Tokenvator.ps1" OR TgtFilePath endswithCIS "\Invoke-TotalExec.ps1" OR TgtFilePath endswithCIS "\Invoke-UrbanBishop.ps1" OR TgtFilePath endswithCIS "\Invoke-UserHunter.ps1" OR TgtFilePath endswithCIS "\Invoke-VoiceTroll.ps1" OR TgtFilePath endswithCIS "\Invoke-Whisker.ps1" OR TgtFilePath endswithCIS "\Invoke-WinEnum.ps1" OR TgtFilePath endswithCIS "\Invoke-winPEAS.ps1" OR TgtFilePath endswithCIS "\Invoke-WireTap.ps1" OR TgtFilePath endswithCIS "\Invoke-WmiCommand.ps1" OR TgtFilePath endswithCIS "\Invoke-WScriptBypassUAC.ps1" OR TgtFilePath endswithCIS "\Invoke-Zerologon.ps1" OR TgtFilePath endswithCIS "\Keylogger.ps1" OR TgtFilePath endswithCIS "\MailRaider.ps1" OR TgtFilePath endswithCIS "\New-HoneyHash.ps1" OR TgtFilePath endswithCIS "\OfficeMemScraper.ps1" OR TgtFilePath endswithCIS "\Offline_Winpwn.ps1" OR TgtFilePath endswithCIS "\Out-CHM.ps1" OR TgtFilePath endswithCIS "\Out-DnsTxt.ps1" OR TgtFilePath endswithCIS "\Out-Excel.ps1" OR TgtFilePath endswithCIS "\Out-HTA.ps1" OR TgtFilePath endswithCIS "\Out-Java.ps1" OR TgtFilePath endswithCIS "\Out-JS.ps1" OR TgtFilePath endswithCIS "\Out-Minidump.ps1" OR TgtFilePath endswithCIS "\Out-RundllCommand.ps1" OR TgtFilePath endswithCIS "\Out-SCF.ps1" OR TgtFilePath endswithCIS "\Out-SCT.ps1" OR TgtFilePath endswithCIS "\Out-Shortcut.ps1" OR TgtFilePath endswithCIS "\Out-WebQuery.ps1" OR TgtFilePath endswithCIS "\Out-Word.ps1" OR TgtFilePath endswithCIS "\Parse_Keys.ps1" OR TgtFilePath endswithCIS "\Port-Scan.ps1" OR TgtFilePath endswithCIS "\PowerBreach.ps1" OR TgtFilePath endswithCIS "\powercat.ps1" OR TgtFilePath endswithCIS "\Powermad.ps1" OR TgtFilePath endswithCIS "\PowerRunAsSystem.psm1" OR TgtFilePath endswithCIS "\PowerSharpPack.ps1" OR TgtFilePath endswithCIS "\PowerUp.ps1" OR TgtFilePath endswithCIS "\PowerUpSQL.ps1" OR TgtFilePath endswithCIS "\PowerView.ps1" OR TgtFilePath endswithCIS "\PSAsyncShell.ps1" OR TgtFilePath endswithCIS "\RemoteHashRetrieval.ps1" OR TgtFilePath endswithCIS "\Remove-Persistence.ps1" OR TgtFilePath endswithCIS "\Remove-PoshRat.ps1" OR TgtFilePath endswithCIS "\Remove-Update.ps1" OR TgtFilePath endswithCIS "\Run-EXEonRemote.ps1" OR TgtFilePath endswithCIS "\Schtasks-Backdoor.ps1" OR TgtFilePath endswithCIS "\Set-DCShadowPermissions.ps1" OR TgtFilePath endswithCIS "\Set-MacAttribute.ps1" OR TgtFilePath endswithCIS "\Set-RemotePSRemoting.ps1" OR TgtFilePath endswithCIS "\Set-RemoteWMI.ps1" OR TgtFilePath endswithCIS "\Set-Wallpaper.ps1" OR TgtFilePath endswithCIS "\Show-TargetScreen.ps1" OR TgtFilePath endswithCIS "\Speak.ps1" OR TgtFilePath endswithCIS "\Start-CaptureServer.ps1" OR TgtFilePath endswithCIS "\Start-WebcamRecorder.ps1" OR TgtFilePath endswithCIS "\StringToBase64.ps1" OR TgtFilePath endswithCIS "\TexttoExe.ps1" OR TgtFilePath endswithCIS "\VolumeShadowCopyTools.ps1" OR TgtFilePath endswithCIS "\WinPwn.ps1" OR TgtFilePath endswithCIS "\WSUSpendu.ps1") OR (TgtFilePath containsCIS "Invoke-Sharp" AND TgtFilePath endswithCIS ".ps1")))

```