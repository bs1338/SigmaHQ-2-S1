# proc_creation_win_hktl_invoke_obfuscation_obfuscated_iex_commandline

## Title
Invoke-Obfuscation Obfuscated IEX Invocation

## ID
4bf943c6-5146-4273-98dd-e958fd1e3abf

## Author
Daniel Bohannon (@Mandiant/@FireEye), oscd.community

## Date
2019-11-08

## Tags
attack.defense-evasion, attack.t1027, attack.execution, attack.t1059.001

## Description
Detects all variations of obfuscated powershell IEX invocation code generated by Invoke-Obfuscation framework from the following code block

## References
https://github.com/danielbohannon/Invoke-Obfuscation/blob/f20e7f843edd0a3a7716736e9eddfa423395dd26/Out-ObfuscatedStringCommand.ps1#L873-L888

## False Positives
Unknown

## SentinelOne Query
```
EventType = "Process Creation" AND (EndpointOS = "windows" AND (TgtProcCmdLine RegExp "\\$PSHome\\[\\s*\\d{1,3}\\s*\\]\\s*\\+\\s*\\$PSHome\\[" OR TgtProcCmdLine RegExp "\\$ShellId\\[\\s*\\d{1,3}\\s*\\]\\s*\\+\\s*\\$ShellId\\[" OR TgtProcCmdLine RegExp "\\$env:Public\\[\\s*\\d{1,3}\\s*\\]\\s*\\+\\s*\\$env:Public\\[" OR TgtProcCmdLine RegExp "\\$env:ComSpec\\[(\\s*\\d{1,3}\\s*,){2}" OR TgtProcCmdLine RegExp "\\*mdr\\*\\W\\s*\\)\\.Name" OR TgtProcCmdLine RegExp "\\$VerbosePreference\\.ToString\\(" OR TgtProcCmdLine RegExp "\\[String\\]\\s*\\$VerbosePreference"))

```