# proc_creation_win_susp_service_tamper

## Title
Suspicious Windows Service Tampering

## ID
ce72ef99-22f1-43d4-8695-419dcb5d9330

## Author
Nasreddine Bencherchali (Nextron Systems), frack113 , X__Junior

## Date
2022-09-01

## Tags
attack.defense-evasion, attack.t1489

## Description
Detects the usage of binaries such as 'net', 'sc' or 'powershell' in order to stop, pause, disable or delete critical or important Windows services such as AV, Backup, etc. As seen being used in some ransomware scripts


## References
https://www.trendmicro.com/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%2010.jpg
https://www.trellix.com/en-sg/about/newsroom/stories/threat-labs/lockergoga-ransomware-family-used-in-targeted-attacks.html
https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md
https://research.nccgroup.com/2022/08/19/back-in-black-unlocking-a-lockbit-3-0-ransomware-attack/
https://www.virustotal.com/gui/file/38283b775552da8981452941ea74191aa0d203edd3f61fb2dee7b0aea3514955

## False Positives
Administrators or tools shutting down the services due to upgrade or removal purposes. If you experience some false positive, please consider adding filters to the parent process launching this command and not removing the entry

## SentinelOne Query
```
EventType = "Process Creation" AND (EndpointOS = "windows" AND ((TgtProcCmdLine containsCIS "143Svc" OR TgtProcCmdLine containsCIS "Acronis VSS Provider" OR TgtProcCmdLine containsCIS "AcronisAgent" OR TgtProcCmdLine containsCIS "AcrSch2Svc" OR TgtProcCmdLine containsCIS "AdobeARMservice" OR TgtProcCmdLine containsCIS "AHS Service" OR TgtProcCmdLine containsCIS "Antivirus" OR TgtProcCmdLine containsCIS "Apache4" OR TgtProcCmdLine containsCIS "ARSM" OR TgtProcCmdLine containsCIS "aswBcc" OR TgtProcCmdLine containsCIS "AteraAgent" OR TgtProcCmdLine containsCIS "Avast Business Console Client Antivirus Service" OR TgtProcCmdLine containsCIS "avast! Antivirus" OR TgtProcCmdLine containsCIS "AVG Antivirus" OR TgtProcCmdLine containsCIS "avgAdminClient" OR TgtProcCmdLine containsCIS "AvgAdminServer" OR TgtProcCmdLine containsCIS "AVP1" OR TgtProcCmdLine containsCIS "BackupExec" OR TgtProcCmdLine containsCIS "bedbg" OR TgtProcCmdLine containsCIS "BITS" OR TgtProcCmdLine containsCIS "BrokerInfrastructure" OR TgtProcCmdLine containsCIS "CASLicenceServer" OR TgtProcCmdLine containsCIS "CASWebServer" OR TgtProcCmdLine containsCIS "Client Agent 7.60" OR TgtProcCmdLine containsCIS "Core Browsing Protection" OR TgtProcCmdLine containsCIS "Core Mail Protection" OR TgtProcCmdLine containsCIS "Core Scanning Server" OR TgtProcCmdLine containsCIS "DCAgent" OR TgtProcCmdLine containsCIS "dwmrcs" OR TgtProcCmdLine containsCIS "EhttpSr" OR TgtProcCmdLine containsCIS "ekrn" OR TgtProcCmdLine containsCIS "Enterprise Client Service" OR TgtProcCmdLine containsCIS "epag" OR TgtProcCmdLine containsCIS "EPIntegrationService" OR TgtProcCmdLine containsCIS "EPProtectedService" OR TgtProcCmdLine containsCIS "EPRedline" OR TgtProcCmdLine containsCIS "EPSecurityService" OR TgtProcCmdLine containsCIS "EPUpdateService" OR TgtProcCmdLine containsCIS "EraserSvc11710" OR TgtProcCmdLine containsCIS "EsgShKernel" OR TgtProcCmdLine containsCIS "ESHASRV" OR TgtProcCmdLine containsCIS "FA_Scheduler" OR TgtProcCmdLine containsCIS "FirebirdGuardianDefaultInstance" OR TgtProcCmdLine containsCIS "FirebirdServerDefaultInstance" OR TgtProcCmdLine containsCIS "FontCache3.0.0.0" OR TgtProcCmdLine containsCIS "HealthTLService" OR TgtProcCmdLine containsCIS "hmpalertsvc" OR TgtProcCmdLine containsCIS "HMS" OR TgtProcCmdLine containsCIS "HostControllerService" OR TgtProcCmdLine containsCIS "hvdsvc" OR TgtProcCmdLine containsCIS "IAStorDataMgrSvc" OR TgtProcCmdLine containsCIS "IBMHPS" OR TgtProcCmdLine containsCIS "ibmspsvc" OR TgtProcCmdLine containsCIS "IISAdmin" OR TgtProcCmdLine containsCIS "IMANSVC" OR TgtProcCmdLine containsCIS "IMAP4Svc" OR TgtProcCmdLine containsCIS "instance2" OR TgtProcCmdLine containsCIS "KAVFS" OR TgtProcCmdLine containsCIS "KAVFSGT" OR TgtProcCmdLine containsCIS "kavfsslp" OR TgtProcCmdLine containsCIS "KeyIso" OR TgtProcCmdLine containsCIS "klbackupdisk" OR TgtProcCmdLine containsCIS "klbackupflt" OR TgtProcCmdLine containsCIS "klflt" OR TgtProcCmdLine containsCIS "klhk" OR TgtProcCmdLine containsCIS "KLIF" OR TgtProcCmdLine containsCIS "klim6" OR TgtProcCmdLine containsCIS "klkbdflt" OR TgtProcCmdLine containsCIS "klmouflt" OR TgtProcCmdLine containsCIS "klnagent" OR TgtProcCmdLine containsCIS "klpd" OR TgtProcCmdLine containsCIS "kltap" OR TgtProcCmdLine containsCIS "KSDE1.0.0" OR TgtProcCmdLine containsCIS "LogProcessorService" OR TgtProcCmdLine containsCIS "M8EndpointAgent" OR TgtProcCmdLine containsCIS "macmnsvc" OR TgtProcCmdLine containsCIS "masvc" OR TgtProcCmdLine containsCIS "MBAMService" OR TgtProcCmdLine containsCIS "MBCloudEA" OR TgtProcCmdLine containsCIS "MBEndpointAgent" OR TgtProcCmdLine containsCIS "McAfeeDLPAgentService" OR TgtProcCmdLine containsCIS "McAfeeEngineService" OR TgtProcCmdLine containsCIS "MCAFEEEVENTPARSERSRV" OR TgtProcCmdLine containsCIS "McAfeeFramework" OR TgtProcCmdLine containsCIS "MCAFEETOMCATSRV530" OR TgtProcCmdLine containsCIS "McShield" OR TgtProcCmdLine containsCIS "McTaskManager" OR TgtProcCmdLine containsCIS "mfefire" OR TgtProcCmdLine containsCIS "mfemms" OR TgtProcCmdLine containsCIS "mfevto" OR TgtProcCmdLine containsCIS "mfevtp" OR TgtProcCmdLine containsCIS "mfewc" OR TgtProcCmdLine containsCIS "MMS" OR TgtProcCmdLine containsCIS "mozyprobackup" OR TgtProcCmdLine containsCIS "MSComplianceAudit" OR TgtProcCmdLine containsCIS "MSDTC" OR TgtProcCmdLine containsCIS "MsDtsServer" OR TgtProcCmdLine containsCIS "MSExchange" OR TgtProcCmdLine containsCIS "msftesq1SPROO" OR TgtProcCmdLine containsCIS "msftesql$PROD" OR TgtProcCmdLine containsCIS "msftesql$SQLEXPRESS" OR TgtProcCmdLine containsCIS "MSOLAP$SQL_2008" OR TgtProcCmdLine containsCIS "MSOLAP$SYSTEM_BGC" OR TgtProcCmdLine containsCIS "MSOLAP$TPS" OR TgtProcCmdLine containsCIS "MSOLAP$TPSAMA" OR TgtProcCmdLine containsCIS "MSOLAPSTPS" OR TgtProcCmdLine containsCIS "MSOLAPSTPSAMA" OR TgtProcCmdLine containsCIS "mssecflt" OR TgtProcCmdLine containsCIS "MSSQ!I.SPROFXENGAGEMEHT" OR TgtProcCmdLine containsCIS "MSSQ0SHAREPOINT" OR TgtProcCmdLine containsCIS "MSSQ0SOPHOS" OR TgtProcCmdLine containsCIS "MSSQL" OR TgtProcCmdLine containsCIS "MSSQLFDLauncher$" OR TgtProcCmdLine containsCIS "MySQL" OR TgtProcCmdLine containsCIS "NanoServiceMain" OR TgtProcCmdLine containsCIS "NetMsmqActivator" OR TgtProcCmdLine containsCIS "NetPipeActivator" OR TgtProcCmdLine containsCIS "netprofm" OR TgtProcCmdLine containsCIS "NetTcpActivator" OR TgtProcCmdLine containsCIS "NetTcpPortSharing" OR TgtProcCmdLine containsCIS "ntrtscan" OR TgtProcCmdLine containsCIS "nvspwmi" OR TgtProcCmdLine containsCIS "ofcservice" OR TgtProcCmdLine containsCIS "Online Protection System" OR TgtProcCmdLine containsCIS "OracleClientCache80" OR TgtProcCmdLine containsCIS "OracleDBConsole" OR TgtProcCmdLine containsCIS "OracleMTSRecoveryService" OR TgtProcCmdLine containsCIS "OracleOraDb11g_home1" OR TgtProcCmdLine containsCIS "OracleService" OR TgtProcCmdLine containsCIS "OracleVssWriter" OR TgtProcCmdLine containsCIS "osppsvc" OR TgtProcCmdLine containsCIS "PandaAetherAgent" OR TgtProcCmdLine containsCIS "PccNTUpd" OR TgtProcCmdLine containsCIS "PDVFSService" OR TgtProcCmdLine containsCIS "POP3Svc" OR TgtProcCmdLine containsCIS "postgresql-x64-9.4" OR TgtProcCmdLine containsCIS "POVFSService" OR TgtProcCmdLine containsCIS "PSUAService" OR TgtProcCmdLine containsCIS "Quick Update Service" OR TgtProcCmdLine containsCIS "RepairService" OR TgtProcCmdLine containsCIS "ReportServer" OR TgtProcCmdLine containsCIS "ReportServer$" OR TgtProcCmdLine containsCIS "RESvc" OR TgtProcCmdLine containsCIS "RpcEptMapper" OR TgtProcCmdLine containsCIS "sacsvr" OR TgtProcCmdLine containsCIS "SamSs" OR TgtProcCmdLine containsCIS "SAVAdminService" OR TgtProcCmdLine containsCIS "SAVService" OR TgtProcCmdLine containsCIS "ScSecSvc" OR TgtProcCmdLine containsCIS "SDRSVC" OR TgtProcCmdLine containsCIS "SearchExchangeTracing" OR TgtProcCmdLine containsCIS "sense" OR TgtProcCmdLine containsCIS "SentinelAgent" OR TgtProcCmdLine containsCIS "SentinelHelperService" OR TgtProcCmdLine containsCIS "SepMasterService" OR TgtProcCmdLine containsCIS "ShMonitor" OR TgtProcCmdLine containsCIS "Smcinst" OR TgtProcCmdLine containsCIS "SmcService" OR TgtProcCmdLine containsCIS "SMTPSvc" OR TgtProcCmdLine containsCIS "SNAC" OR TgtProcCmdLine containsCIS "SntpService" OR TgtProcCmdLine containsCIS "Sophos" OR TgtProcCmdLine containsCIS "SQ1SafeOLRService" OR TgtProcCmdLine containsCIS "SQL Backups" OR TgtProcCmdLine containsCIS "SQL Server" OR TgtProcCmdLine containsCIS "SQLAgent" OR TgtProcCmdLine containsCIS "SQLANYs_Sage_FAS_Fixed_Assets" OR TgtProcCmdLine containsCIS "SQLBrowser" OR TgtProcCmdLine containsCIS "SQLsafe" OR TgtProcCmdLine containsCIS "SQLSERVERAGENT" OR TgtProcCmdLine containsCIS "SQLTELEMETRY" OR TgtProcCmdLine containsCIS "SQLWriter" OR TgtProcCmdLine containsCIS "SSISTELEMETRY130" OR TgtProcCmdLine containsCIS "SstpSvc" OR TgtProcCmdLine containsCIS "storflt" OR TgtProcCmdLine containsCIS "svcGenericHost" OR TgtProcCmdLine containsCIS "swc_service" OR TgtProcCmdLine containsCIS "swi_filter" OR TgtProcCmdLine containsCIS "swi_service" OR TgtProcCmdLine containsCIS "swi_update" OR TgtProcCmdLine containsCIS "Symantec" OR TgtProcCmdLine containsCIS "TeamViewer" OR TgtProcCmdLine containsCIS "Telemetryserver" OR TgtProcCmdLine containsCIS "ThreatLockerService" OR TgtProcCmdLine containsCIS "TMBMServer" OR TgtProcCmdLine containsCIS "TmCCSF" OR TgtProcCmdLine containsCIS "TmFilter" OR TgtProcCmdLine containsCIS "TMiCRCScanService" OR TgtProcCmdLine containsCIS "tmlisten" OR TgtProcCmdLine containsCIS "TMLWCSService" OR TgtProcCmdLine containsCIS "TmPfw" OR TgtProcCmdLine containsCIS "TmPreFilter" OR TgtProcCmdLine containsCIS "TmProxy" OR TgtProcCmdLine containsCIS "TMSmartRelayService" OR TgtProcCmdLine containsCIS "tmusa" OR TgtProcCmdLine containsCIS "Tomcat" OR TgtProcCmdLine containsCIS "Trend Micro Deep Security Manager" OR TgtProcCmdLine containsCIS "TrueKey" OR TgtProcCmdLine containsCIS "UFNet" OR TgtProcCmdLine containsCIS "UI0Detect" OR TgtProcCmdLine containsCIS "UniFi" OR TgtProcCmdLine containsCIS "UTODetect" OR TgtProcCmdLine containsCIS "vds" OR TgtProcCmdLine containsCIS "Veeam" OR TgtProcCmdLine containsCIS "VeeamDeploySvc" OR TgtProcCmdLine containsCIS "Veritas System Recovery" OR TgtProcCmdLine containsCIS "vmic" OR TgtProcCmdLine containsCIS "VMTools" OR TgtProcCmdLine containsCIS "vmvss" OR TgtProcCmdLine containsCIS "VSApiNt" OR TgtProcCmdLine containsCIS "VSS" OR TgtProcCmdLine containsCIS "W3Svc" OR TgtProcCmdLine containsCIS "wbengine" OR TgtProcCmdLine containsCIS "WdNisSvc" OR TgtProcCmdLine containsCIS "WeanClOudSve" OR TgtProcCmdLine containsCIS "Weems JY" OR TgtProcCmdLine containsCIS "WinDefend" OR TgtProcCmdLine containsCIS "wmms" OR TgtProcCmdLine containsCIS "wozyprobackup" OR TgtProcCmdLine containsCIS "WPFFontCache_v0400" OR TgtProcCmdLine containsCIS "WRSVC" OR TgtProcCmdLine containsCIS "wsbexchange" OR TgtProcCmdLine containsCIS "WSearch" OR TgtProcCmdLine containsCIS "Zoolz 2 Service") AND ((TgtProcCmdLine containsCIS " delete " OR TgtProcCmdLine containsCIS " pause " OR TgtProcCmdLine containsCIS " stop " OR TgtProcCmdLine containsCIS "Stop-Service " OR TgtProcCmdLine containsCIS "Remove-Service ") OR (TgtProcCmdLine containsCIS "config" AND TgtProcCmdLine containsCIS "start=disabled")) AND (TgtProcImagePath endswithCIS "\net.exe" OR TgtProcImagePath endswithCIS "\net1.exe" OR TgtProcImagePath endswithCIS "\powershell.exe" OR TgtProcImagePath endswithCIS "\PsService.exe" OR TgtProcImagePath endswithCIS "\PsService64.exe" OR TgtProcImagePath endswithCIS "\pwsh.exe" OR TgtProcImagePath endswithCIS "\sc.exe")))

```