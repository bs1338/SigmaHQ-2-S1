# proc_creation_win_sysinternals_psexec_paexec_escalate_system

## Title
PsExec/PAExec Escalation to LOCAL SYSTEM

## ID
8834e2f7-6b4b-4f09-8906-d2276470ee23

## Author
Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)

## Date
2021-11-23

## Tags
attack.resource-development, attack.t1587.001

## Description
Detects suspicious commandline flags used by PsExec and PAExec to escalate a command line to LOCAL_SYSTEM rights

## References
https://learn.microsoft.com/en-us/sysinternals/downloads/psexec
https://www.poweradmin.com/paexec/
https://www.fireeye.com/blog/threat-research/2020/10/kegtap-and-singlemalt-with-a-ransomware-chaser.html

## False Positives
Admins that use PsExec or PAExec to escalate to the SYSTEM account for maintenance purposes (rare)
Users that debug Microsoft Intune issues using the commands mentioned in the official documentation; see https://learn.microsoft.com/en-us/mem/intune/apps/intune-management-extension

## SentinelOne Query
```
EventType = "Process Creation" AND (EndpointOS = "windows" AND ((TgtProcCmdLine containsCIS "psexec" OR TgtProcCmdLine containsCIS "paexec" OR TgtProcCmdLine containsCIS "accepteula") AND (TgtProcCmdLine containsCIS " -s cmd" OR TgtProcCmdLine containsCIS " /s cmd" OR TgtProcCmdLine containsCIS " â€“s cmd" OR TgtProcCmdLine containsCIS " â€”s cmd" OR TgtProcCmdLine containsCIS " â€•s cmd" OR TgtProcCmdLine containsCIS " -s -i cmd" OR TgtProcCmdLine containsCIS " -s /i cmd" OR TgtProcCmdLine containsCIS " -s â€“i cmd" OR TgtProcCmdLine containsCIS " -s â€”i cmd" OR TgtProcCmdLine containsCIS " -s â€•i cmd" OR TgtProcCmdLine containsCIS " /s -i cmd" OR TgtProcCmdLine containsCIS " /s /i cmd" OR TgtProcCmdLine containsCIS " /s â€“i cmd" OR TgtProcCmdLine containsCIS " /s â€”i cmd" OR TgtProcCmdLine containsCIS " /s â€•i cmd" OR TgtProcCmdLine containsCIS " â€“s -i cmd" OR TgtProcCmdLine containsCIS " â€“s /i cmd" OR TgtProcCmdLine containsCIS " â€“s â€“i cmd" OR TgtProcCmdLine containsCIS " â€“s â€”i cmd" OR TgtProcCmdLine containsCIS " â€“s â€•i cmd" OR TgtProcCmdLine containsCIS " â€”s -i cmd" OR TgtProcCmdLine containsCIS " â€”s /i cmd" OR TgtProcCmdLine containsCIS " â€”s â€“i cmd" OR TgtProcCmdLine containsCIS " â€”s â€”i cmd" OR TgtProcCmdLine containsCIS " â€”s â€•i cmd" OR TgtProcCmdLine containsCIS " â€•s -i cmd" OR TgtProcCmdLine containsCIS " â€•s /i cmd" OR TgtProcCmdLine containsCIS " â€•s â€“i cmd" OR TgtProcCmdLine containsCIS " â€•s â€”i cmd" OR TgtProcCmdLine containsCIS " â€•s â€•i cmd" OR TgtProcCmdLine containsCIS " -i -s cmd" OR TgtProcCmdLine containsCIS " -i /s cmd" OR TgtProcCmdLine containsCIS " -i â€“s cmd" OR TgtProcCmdLine containsCIS " -i â€”s cmd" OR TgtProcCmdLine containsCIS " -i â€•s cmd" OR TgtProcCmdLine containsCIS " /i -s cmd" OR TgtProcCmdLine containsCIS " /i /s cmd" OR TgtProcCmdLine containsCIS " /i â€“s cmd" OR TgtProcCmdLine containsCIS " /i â€”s cmd" OR TgtProcCmdLine containsCIS " /i â€•s cmd" OR TgtProcCmdLine containsCIS " â€“i -s cmd" OR TgtProcCmdLine containsCIS " â€“i /s cmd" OR TgtProcCmdLine containsCIS " â€“i â€“s cmd" OR TgtProcCmdLine containsCIS " â€“i â€”s cmd" OR TgtProcCmdLine containsCIS " â€“i â€•s cmd" OR TgtProcCmdLine containsCIS " â€”i -s cmd" OR TgtProcCmdLine containsCIS " â€”i /s cmd" OR TgtProcCmdLine containsCIS " â€”i â€“s cmd" OR TgtProcCmdLine containsCIS " â€”i â€”s cmd" OR TgtProcCmdLine containsCIS " â€”i â€•s cmd" OR TgtProcCmdLine containsCIS " â€•i -s cmd" OR TgtProcCmdLine containsCIS " â€•i /s cmd" OR TgtProcCmdLine containsCIS " â€•i â€“s cmd" OR TgtProcCmdLine containsCIS " â€•i â€”s cmd" OR TgtProcCmdLine containsCIS " â€•i â€•s cmd" OR TgtProcCmdLine containsCIS " -s pwsh" OR TgtProcCmdLine containsCIS " /s pwsh" OR TgtProcCmdLine containsCIS " â€“s pwsh" OR TgtProcCmdLine containsCIS " â€”s pwsh" OR TgtProcCmdLine containsCIS " â€•s pwsh" OR TgtProcCmdLine containsCIS " -s -i pwsh" OR TgtProcCmdLine containsCIS " -s /i pwsh" OR TgtProcCmdLine containsCIS " -s â€“i pwsh" OR TgtProcCmdLine containsCIS " -s â€”i pwsh" OR TgtProcCmdLine containsCIS " -s â€•i pwsh" OR TgtProcCmdLine containsCIS " /s -i pwsh" OR TgtProcCmdLine containsCIS " /s /i pwsh" OR TgtProcCmdLine containsCIS " /s â€“i pwsh" OR TgtProcCmdLine containsCIS " /s â€”i pwsh" OR TgtProcCmdLine containsCIS " /s â€•i pwsh" OR TgtProcCmdLine containsCIS " â€“s -i pwsh" OR TgtProcCmdLine containsCIS " â€“s /i pwsh" OR TgtProcCmdLine containsCIS " â€“s â€“i pwsh" OR TgtProcCmdLine containsCIS " â€“s â€”i pwsh" OR TgtProcCmdLine containsCIS " â€“s â€•i pwsh" OR TgtProcCmdLine containsCIS " â€”s -i pwsh" OR TgtProcCmdLine containsCIS " â€”s /i pwsh" OR TgtProcCmdLine containsCIS " â€”s â€“i pwsh" OR TgtProcCmdLine containsCIS " â€”s â€”i pwsh" OR TgtProcCmdLine containsCIS " â€”s â€•i pwsh" OR TgtProcCmdLine containsCIS " â€•s -i pwsh" OR TgtProcCmdLine containsCIS " â€•s /i pwsh" OR TgtProcCmdLine containsCIS " â€•s â€“i pwsh" OR TgtProcCmdLine containsCIS " â€•s â€”i pwsh" OR TgtProcCmdLine containsCIS " â€•s â€•i pwsh" OR TgtProcCmdLine containsCIS " -i -s pwsh" OR TgtProcCmdLine containsCIS " -i /s pwsh" OR TgtProcCmdLine containsCIS " -i â€“s pwsh" OR TgtProcCmdLine containsCIS " -i â€”s pwsh" OR TgtProcCmdLine containsCIS " -i â€•s pwsh" OR TgtProcCmdLine containsCIS " /i -s pwsh" OR TgtProcCmdLine containsCIS " /i /s pwsh" OR TgtProcCmdLine containsCIS " /i â€“s pwsh" OR TgtProcCmdLine containsCIS " /i â€”s pwsh" OR TgtProcCmdLine containsCIS " /i â€•s pwsh" OR TgtProcCmdLine containsCIS " â€“i -s pwsh" OR TgtProcCmdLine containsCIS " â€“i /s pwsh" OR TgtProcCmdLine containsCIS " â€“i â€“s pwsh" OR TgtProcCmdLine containsCIS " â€“i â€”s pwsh" OR TgtProcCmdLine containsCIS " â€“i â€•s pwsh" OR TgtProcCmdLine containsCIS " â€”i -s pwsh" OR TgtProcCmdLine containsCIS " â€”i /s pwsh" OR TgtProcCmdLine containsCIS " â€”i â€“s pwsh" OR TgtProcCmdLine containsCIS " â€”i â€”s pwsh" OR TgtProcCmdLine containsCIS " â€”i â€•s pwsh" OR TgtProcCmdLine containsCIS " â€•i -s pwsh" OR TgtProcCmdLine containsCIS " â€•i /s pwsh" OR TgtProcCmdLine containsCIS " â€•i â€“s pwsh" OR TgtProcCmdLine containsCIS " â€•i â€”s pwsh" OR TgtProcCmdLine containsCIS " â€•i â€•s pwsh" OR TgtProcCmdLine containsCIS " -s powershell" OR TgtProcCmdLine containsCIS " /s powershell" OR TgtProcCmdLine containsCIS " â€“s powershell" OR TgtProcCmdLine containsCIS " â€”s powershell" OR TgtProcCmdLine containsCIS " â€•s powershell" OR TgtProcCmdLine containsCIS " -s -i powershell" OR TgtProcCmdLine containsCIS " -s /i powershell" OR TgtProcCmdLine containsCIS " -s â€“i powershell" OR TgtProcCmdLine containsCIS " -s â€”i powershell" OR TgtProcCmdLine containsCIS " -s â€•i powershell" OR TgtProcCmdLine containsCIS " /s -i powershell" OR TgtProcCmdLine containsCIS " /s /i powershell" OR TgtProcCmdLine containsCIS " /s â€“i powershell" OR TgtProcCmdLine containsCIS " /s â€”i powershell" OR TgtProcCmdLine containsCIS " /s â€•i powershell" OR TgtProcCmdLine containsCIS " â€“s -i powershell" OR TgtProcCmdLine containsCIS " â€“s /i powershell" OR TgtProcCmdLine containsCIS " â€“s â€“i powershell" OR TgtProcCmdLine containsCIS " â€“s â€”i powershell" OR TgtProcCmdLine containsCIS " â€“s â€•i powershell" OR TgtProcCmdLine containsCIS " â€”s -i powershell" OR TgtProcCmdLine containsCIS " â€”s /i powershell" OR TgtProcCmdLine containsCIS " â€”s â€“i powershell" OR TgtProcCmdLine containsCIS " â€”s â€”i powershell" OR TgtProcCmdLine containsCIS " â€”s â€•i powershell" OR TgtProcCmdLine containsCIS " â€•s -i powershell" OR TgtProcCmdLine containsCIS " â€•s /i powershell" OR TgtProcCmdLine containsCIS " â€•s â€“i powershell" OR TgtProcCmdLine containsCIS " â€•s â€”i powershell" OR TgtProcCmdLine containsCIS " â€•s â€•i powershell" OR TgtProcCmdLine containsCIS " -i -s powershell" OR TgtProcCmdLine containsCIS " -i /s powershell" OR TgtProcCmdLine containsCIS " -i â€“s powershell" OR TgtProcCmdLine containsCIS " -i â€”s powershell" OR TgtProcCmdLine containsCIS " -i â€•s powershell" OR TgtProcCmdLine containsCIS " /i -s powershell" OR TgtProcCmdLine containsCIS " /i /s powershell" OR TgtProcCmdLine containsCIS " /i â€“s powershell" OR TgtProcCmdLine containsCIS " /i â€”s powershell" OR TgtProcCmdLine containsCIS " /i â€•s powershell" OR TgtProcCmdLine containsCIS " â€“i -s powershell" OR TgtProcCmdLine containsCIS " â€“i /s powershell" OR TgtProcCmdLine containsCIS " â€“i â€“s powershell" OR TgtProcCmdLine containsCIS " â€“i â€”s powershell" OR TgtProcCmdLine containsCIS " â€“i â€•s powershell" OR TgtProcCmdLine containsCIS " â€”i -s powershell" OR TgtProcCmdLine containsCIS " â€”i /s powershell" OR TgtProcCmdLine containsCIS " â€”i â€“s powershell" OR TgtProcCmdLine containsCIS " â€”i â€”s powershell" OR TgtProcCmdLine containsCIS " â€”i â€•s powershell" OR TgtProcCmdLine containsCIS " â€•i -s powershell" OR TgtProcCmdLine containsCIS " â€•i /s powershell" OR TgtProcCmdLine containsCIS " â€•i â€“s powershell" OR TgtProcCmdLine containsCIS " â€•i â€”s powershell" OR TgtProcCmdLine containsCIS " â€•i â€•s powershell")))

```