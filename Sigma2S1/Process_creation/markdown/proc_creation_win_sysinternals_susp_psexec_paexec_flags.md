# proc_creation_win_sysinternals_susp_psexec_paexec_flags

## Title
Potential Privilege Escalation To LOCAL SYSTEM

## ID
207b0396-3689-42d9-8399-4222658efc99

## Author
Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)

## Date
2021-05-22

## Tags
attack.resource-development, attack.t1587.001

## Description
Detects unknown program using commandline flags usually used by tools such as PsExec and PAExec to start programs with SYSTEM Privileges

## References
https://learn.microsoft.com/en-us/sysinternals/downloads/psexec
https://www.poweradmin.com/paexec/
https://www.fireeye.com/blog/threat-research/2020/10/kegtap-and-singlemalt-with-a-ransomware-chaser.html

## False Positives
Weird admins that rename their tools
Software companies that bundle PsExec/PAExec with their software and rename it, so that it is less embarrassing

## SentinelOne Query
```
EventType = "Process Creation" AND (EndpointOS = "windows" AND ((TgtProcCmdLine containsCIS " -s cmd" OR TgtProcCmdLine containsCIS " /s cmd" OR TgtProcCmdLine containsCIS " â€“s cmd" OR TgtProcCmdLine containsCIS " â€”s cmd" OR TgtProcCmdLine containsCIS " â€•s cmd" OR TgtProcCmdLine containsCIS " -s -i cmd" OR TgtProcCmdLine containsCIS " -s /i cmd" OR TgtProcCmdLine containsCIS " -s â€“i cmd" OR TgtProcCmdLine containsCIS " -s â€”i cmd" OR TgtProcCmdLine containsCIS " -s â€•i cmd" OR TgtProcCmdLine containsCIS " /s -i cmd" OR TgtProcCmdLine containsCIS " /s /i cmd" OR TgtProcCmdLine containsCIS " /s â€“i cmd" OR TgtProcCmdLine containsCIS " /s â€”i cmd" OR TgtProcCmdLine containsCIS " /s â€•i cmd" OR TgtProcCmdLine containsCIS " â€“s -i cmd" OR TgtProcCmdLine containsCIS " â€“s /i cmd" OR TgtProcCmdLine containsCIS " â€“s â€“i cmd" OR TgtProcCmdLine containsCIS " â€“s â€”i cmd" OR TgtProcCmdLine containsCIS " â€“s â€•i cmd" OR TgtProcCmdLine containsCIS " â€”s -i cmd" OR TgtProcCmdLine containsCIS " â€”s /i cmd" OR TgtProcCmdLine containsCIS " â€”s â€“i cmd" OR TgtProcCmdLine containsCIS " â€”s â€”i cmd" OR TgtProcCmdLine containsCIS " â€”s â€•i cmd" OR TgtProcCmdLine containsCIS " â€•s -i cmd" OR TgtProcCmdLine containsCIS " â€•s /i cmd" OR TgtProcCmdLine containsCIS " â€•s â€“i cmd" OR TgtProcCmdLine containsCIS " â€•s â€”i cmd" OR TgtProcCmdLine containsCIS " â€•s â€•i cmd" OR TgtProcCmdLine containsCIS " -i -s cmd" OR TgtProcCmdLine containsCIS " -i /s cmd" OR TgtProcCmdLine containsCIS " -i â€“s cmd" OR TgtProcCmdLine containsCIS " -i â€”s cmd" OR TgtProcCmdLine containsCIS " -i â€•s cmd" OR TgtProcCmdLine containsCIS " /i -s cmd" OR TgtProcCmdLine containsCIS " /i /s cmd" OR TgtProcCmdLine containsCIS " /i â€“s cmd" OR TgtProcCmdLine containsCIS " /i â€”s cmd" OR TgtProcCmdLine containsCIS " /i â€•s cmd" OR TgtProcCmdLine containsCIS " â€“i -s cmd" OR TgtProcCmdLine containsCIS " â€“i /s cmd" OR TgtProcCmdLine containsCIS " â€“i â€“s cmd" OR TgtProcCmdLine containsCIS " â€“i â€”s cmd" OR TgtProcCmdLine containsCIS " â€“i â€•s cmd" OR TgtProcCmdLine containsCIS " â€”i -s cmd" OR TgtProcCmdLine containsCIS " â€”i /s cmd" OR TgtProcCmdLine containsCIS " â€”i â€“s cmd" OR TgtProcCmdLine containsCIS " â€”i â€”s cmd" OR TgtProcCmdLine containsCIS " â€”i â€•s cmd" OR TgtProcCmdLine containsCIS " â€•i -s cmd" OR TgtProcCmdLine containsCIS " â€•i /s cmd" OR TgtProcCmdLine containsCIS " â€•i â€“s cmd" OR TgtProcCmdLine containsCIS " â€•i â€”s cmd" OR TgtProcCmdLine containsCIS " â€•i â€•s cmd" OR TgtProcCmdLine containsCIS " -s pwsh" OR TgtProcCmdLine containsCIS " /s pwsh" OR TgtProcCmdLine containsCIS " â€“s pwsh" OR TgtProcCmdLine containsCIS " â€”s pwsh" OR TgtProcCmdLine containsCIS " â€•s pwsh" OR TgtProcCmdLine containsCIS " -s -i pwsh" OR TgtProcCmdLine containsCIS " -s /i pwsh" OR TgtProcCmdLine containsCIS " -s â€“i pwsh" OR TgtProcCmdLine containsCIS " -s â€”i pwsh" OR TgtProcCmdLine containsCIS " -s â€•i pwsh" OR TgtProcCmdLine containsCIS " /s -i pwsh" OR TgtProcCmdLine containsCIS " /s /i pwsh" OR TgtProcCmdLine containsCIS " /s â€“i pwsh" OR TgtProcCmdLine containsCIS " /s â€”i pwsh" OR TgtProcCmdLine containsCIS " /s â€•i pwsh" OR TgtProcCmdLine containsCIS " â€“s -i pwsh" OR TgtProcCmdLine containsCIS " â€“s /i pwsh" OR TgtProcCmdLine containsCIS " â€“s â€“i pwsh" OR TgtProcCmdLine containsCIS " â€“s â€”i pwsh" OR TgtProcCmdLine containsCIS " â€“s â€•i pwsh" OR TgtProcCmdLine containsCIS " â€”s -i pwsh" OR TgtProcCmdLine containsCIS " â€”s /i pwsh" OR TgtProcCmdLine containsCIS " â€”s â€“i pwsh" OR TgtProcCmdLine containsCIS " â€”s â€”i pwsh" OR TgtProcCmdLine containsCIS " â€”s â€•i pwsh" OR TgtProcCmdLine containsCIS " â€•s -i pwsh" OR TgtProcCmdLine containsCIS " â€•s /i pwsh" OR TgtProcCmdLine containsCIS " â€•s â€“i pwsh" OR TgtProcCmdLine containsCIS " â€•s â€”i pwsh" OR TgtProcCmdLine containsCIS " â€•s â€•i pwsh" OR TgtProcCmdLine containsCIS " -i -s pwsh" OR TgtProcCmdLine containsCIS " -i /s pwsh" OR TgtProcCmdLine containsCIS " -i â€“s pwsh" OR TgtProcCmdLine containsCIS " -i â€”s pwsh" OR TgtProcCmdLine containsCIS " -i â€•s pwsh" OR TgtProcCmdLine containsCIS " /i -s pwsh" OR TgtProcCmdLine containsCIS " /i /s pwsh" OR TgtProcCmdLine containsCIS " /i â€“s pwsh" OR TgtProcCmdLine containsCIS " /i â€”s pwsh" OR TgtProcCmdLine containsCIS " /i â€•s pwsh" OR TgtProcCmdLine containsCIS " â€“i -s pwsh" OR TgtProcCmdLine containsCIS " â€“i /s pwsh" OR TgtProcCmdLine containsCIS " â€“i â€“s pwsh" OR TgtProcCmdLine containsCIS " â€“i â€”s pwsh" OR TgtProcCmdLine containsCIS " â€“i â€•s pwsh" OR TgtProcCmdLine containsCIS " â€”i -s pwsh" OR TgtProcCmdLine containsCIS " â€”i /s pwsh" OR TgtProcCmdLine containsCIS " â€”i â€“s pwsh" OR TgtProcCmdLine containsCIS " â€”i â€”s pwsh" OR TgtProcCmdLine containsCIS " â€”i â€•s pwsh" OR TgtProcCmdLine containsCIS " â€•i -s pwsh" OR TgtProcCmdLine containsCIS " â€•i /s pwsh" OR TgtProcCmdLine containsCIS " â€•i â€“s pwsh" OR TgtProcCmdLine containsCIS " â€•i â€”s pwsh" OR TgtProcCmdLine containsCIS " â€•i â€•s pwsh" OR TgtProcCmdLine containsCIS " -s powershell" OR TgtProcCmdLine containsCIS " /s powershell" OR TgtProcCmdLine containsCIS " â€“s powershell" OR TgtProcCmdLine containsCIS " â€”s powershell" OR TgtProcCmdLine containsCIS " â€•s powershell" OR TgtProcCmdLine containsCIS " -s -i powershell" OR TgtProcCmdLine containsCIS " -s /i powershell" OR TgtProcCmdLine containsCIS " -s â€“i powershell" OR TgtProcCmdLine containsCIS " -s â€”i powershell" OR TgtProcCmdLine containsCIS " -s â€•i powershell" OR TgtProcCmdLine containsCIS " /s -i powershell" OR TgtProcCmdLine containsCIS " /s /i powershell" OR TgtProcCmdLine containsCIS " /s â€“i powershell" OR TgtProcCmdLine containsCIS " /s â€”i powershell" OR TgtProcCmdLine containsCIS " /s â€•i powershell" OR TgtProcCmdLine containsCIS " â€“s -i powershell" OR TgtProcCmdLine containsCIS " â€“s /i powershell" OR TgtProcCmdLine containsCIS " â€“s â€“i powershell" OR TgtProcCmdLine containsCIS " â€“s â€”i powershell" OR TgtProcCmdLine containsCIS " â€“s â€•i powershell" OR TgtProcCmdLine containsCIS " â€”s -i powershell" OR TgtProcCmdLine containsCIS " â€”s /i powershell" OR TgtProcCmdLine containsCIS " â€”s â€“i powershell" OR TgtProcCmdLine containsCIS " â€”s â€”i powershell" OR TgtProcCmdLine containsCIS " â€”s â€•i powershell" OR TgtProcCmdLine containsCIS " â€•s -i powershell" OR TgtProcCmdLine containsCIS " â€•s /i powershell" OR TgtProcCmdLine containsCIS " â€•s â€“i powershell" OR TgtProcCmdLine containsCIS " â€•s â€”i powershell" OR TgtProcCmdLine containsCIS " â€•s â€•i powershell" OR TgtProcCmdLine containsCIS " -i -s powershell" OR TgtProcCmdLine containsCIS " -i /s powershell" OR TgtProcCmdLine containsCIS " -i â€“s powershell" OR TgtProcCmdLine containsCIS " -i â€”s powershell" OR TgtProcCmdLine containsCIS " -i â€•s powershell" OR TgtProcCmdLine containsCIS " /i -s powershell" OR TgtProcCmdLine containsCIS " /i /s powershell" OR TgtProcCmdLine containsCIS " /i â€“s powershell" OR TgtProcCmdLine containsCIS " /i â€”s powershell" OR TgtProcCmdLine containsCIS " /i â€•s powershell" OR TgtProcCmdLine containsCIS " â€“i -s powershell" OR TgtProcCmdLine containsCIS " â€“i /s powershell" OR TgtProcCmdLine containsCIS " â€“i â€“s powershell" OR TgtProcCmdLine containsCIS " â€“i â€”s powershell" OR TgtProcCmdLine containsCIS " â€“i â€•s powershell" OR TgtProcCmdLine containsCIS " â€”i -s powershell" OR TgtProcCmdLine containsCIS " â€”i /s powershell" OR TgtProcCmdLine containsCIS " â€”i â€“s powershell" OR TgtProcCmdLine containsCIS " â€”i â€”s powershell" OR TgtProcCmdLine containsCIS " â€”i â€•s powershell" OR TgtProcCmdLine containsCIS " â€•i -s powershell" OR TgtProcCmdLine containsCIS " â€•i /s powershell" OR TgtProcCmdLine containsCIS " â€•i â€“s powershell" OR TgtProcCmdLine containsCIS " â€•i â€”s powershell" OR TgtProcCmdLine containsCIS " â€•i â€•s powershell") AND (NOT (TgtProcCmdLine containsCIS "paexec" OR TgtProcCmdLine containsCIS "PsExec" OR TgtProcCmdLine containsCIS "accepteula"))))

```